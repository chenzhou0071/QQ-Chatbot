# 智能QQ交互智能体（Windows部署版）项目计划书

一、项目概述

本项目基于Python开发，聚焦Windows环境稳定部署，实现智能体登录QQ账号完成双向智能交互，核心覆盖主动发起聊天、海量照片存储与语义记忆、图片收发、QQ语音识别转文字能力，依托MySQL存储结构化业务数据、向量数据库实现内容语义检索，打造功能完整、易部署、高可用的QQ智能交互系统，适配Windows日常使用场景与后台运行需求。

二、项目核心目标

- 实现Windows环境下QQ账号稳定登录、消息双向收发，支持主动向好友/群聊发起文本、图片聊天，保障交互流畅性
- 完成QQ语音消息精准识别转文字，解决语音交互壁垒，支持语音内容留存与检索
- 实现照片批量接收、本地归档、语义记忆，支持按场景/语义检索历史照片，可随交互需求主动发送
- 搭建Python+MySQL+向量数据库的轻量化技术架构，适配Windows部署、后台运行与长期稳定使用
- 输出完整可落地的项目文档，覆盖环境搭建、部署操作、功能使用、问题排查全流程

三、技术选型（适配Windows+Python生态）

核心开发语言

Python 3.9+ （生态丰富、适配Windows系统，便捷调用QQ协议、语音识别、数据库相关依赖库，开发门槛可控）

QQ协议与交互核心层（核心支撑）

- 主推方案：**NoneBot2 + go-cqhttp** （Windows适配性极强，轻量化易部署，支持QQ扫码/快捷登录，稳定实现文本/图片/语音消息收发、主动发消息，社区文档完善，问题排查便捷）

语音识别模块（双方案可选，按需适配）

- 在线方案（推荐，准确率优先）：百度语音识别API/阿里云语音识别API

优势：支持QQ语音常见格式，识别准确率高，支持长语音解析，无需本地部署模型，Windows环境直接调用

- 离线方案（隐私优先）：PocketSphinx + 中文语料库

优势：无网络依赖，数据本地处理，适配Windows离线使用场景，需额外配置中文识别语料

数据存储层（结构化+语义化双存储）

- MySQL 8.0（Windows版）：存储结构化核心数据，适配Windows本地部署，易通过可视化工具管理，稳定性强
- 向量数据库（轻量化优先）：**Chroma** / **FAISS**

优势：Python原生支持，Windows环境免复杂部署，适配文本与图片向量存储/检索，轻量化无额外资源消耗

- 本地存储：Windows本地目录归档照片文件，配合MySQL记录元数据，保障照片存储安全与检索便捷

辅助依赖库（Windows适配）

- 图片处理：Pillow（图片格式转换、压缩、尺寸调整，适配QQ图片发送规范）
- 向量生成：Sentence-BERT（聊天文本语义向量生成）、CLIP（照片视觉特征向量生成）
- 语音格式转换：ffmpeg（Windows版），解决QQ语音amr/silk格式与识别库兼容问题
- 后台运行：nssm（将Python进程注册为Windows系统服务，实现开机自启、后台运行）
- 环境管理：Anaconda/venv（隔离Python依赖，避免Windows环境依赖冲突）
- 可视化辅助：Navicat（MySQL可视化管理）、Chroma UI（可选，向量数据库可视化检索）

四、系统架构设计（分层解耦，易扩展）

整体分层架构（自上而下）

- 交互接入层：QQ协议适配模块，负责QQ登录、消息监听（文本/图片/语音）、消息发送（文本/图片）、主动聊天触发，是系统与QQ的核心桥梁
- 核心处理层：智能交互逻辑模块、语音识别转换模块、向量生成模块，承载核心业务处理，实现语音转写、交互响应、内容向量化
- 数据存储层：MySQL结构化存储、向量数据库语义存储、本地文件存储，支撑全量数据的留存与检索
- 部署运维层：Windows环境配置、依赖管理、进程守护、日志管理，保障系统稳定运行与运维便捷

核心模块详细拆解

QQ协议适配模块（核心交互入口）

- 核心功能：Windows环境下QQ账号扫码登录，维持长连接；实时监听好友/群聊的文本、图片、语音消息；主动向指定QQ号/群聊发送文本、本地照片；异常重连（网络波动、登录失效自动触发重连）
- 关键逻辑：消息过滤（筛选目标好友/有效消息，屏蔽无效信息）；登录状态监控，异常时弹窗/日志提醒；消息收发回执记录，保障数据不丢失

语音识别处理模块（语音交互核心）

- 核心流程：接收QQ语音消息→调用ffmpeg转换为wav通用格式→接入离线/在线识别接口→输出文字转写结果→同步转写文本至MySQL聊天记录→支持转写内容检索
- 关键优化：适配Windows音频解码环境，解决格式转换失败问题；识别失败重试机制；长语音分段处理，提升识别准确率

智能交互与主动聊天模块（交互核心）

- 核心功能：接收文本/语音转写内容，执行预设交互逻辑；支持主动聊天触发（定时触发：如每日问候；场景触发：如好友生日提醒；语义触发：如检索到关联记忆主动发起话题）；交互时可调用向量数据库，关联历史聊天/照片，丰富回复内容
- 扩展预留：支持后续接入大语言模型（LLM），提升交互智能度

数据存储与记忆模块（系统数据支撑）

- MySQL存储：负责结构化数据全量留存，支持精准查询与溯源
- 向量数据库存储：负责语义化记忆，支撑智能检索，实现“记忆唤醒”
- 本地文件存储：Windows指定目录归档接收/待发送照片，按“好友ID+日期”分文件夹管理，避免文件混乱

日志与监控模块（运维支撑）

- 核心功能：记录系统运行日志（登录状态、消息处理、异常信息）、交互日志（聊天内容、照片收发、语音转写）；关键异常（登录失败、识别失败、数据库连接异常）弹窗提醒；日志按日期归档，便于问题追溯

五、数据层详细设计（结构化+语义化双支撑）

MySQL核心数据表设计（关键字段，适配Windows使用）

好友信息表（friend_info）- 存储好友基础信息

|     |     |     |     |
| --- | --- | --- | --- |
| 字段名 | 字段类型 | 主键  | 备注  |
| friend_id | VARCHAR(20) | 是   | 好友QQ号（唯一标识） |
| friend_name | VARCHAR(50) | 否   | 好友昵称 |
| remark_name | VARCHAR(50) | 否   | 好友备注（便于识别） |
| is_valid | TINYINT(1) | 否   | 是否为有效交互好友（1是0否） |
| create_time | DATETIME | 否   | 好友添加时间 |
| update_time | DATETIME | 否   | 信息更新时间 |

聊天记录表（chat_record）- 存储全量交互内容

|     |     |     |     |
| --- | --- | --- | --- |
| 字段名 | 字段类型 | 主键  | 备注  |
| record_id | INT(11) | 是   | 自增主键 |
| sender_id | VARCHAR(20) | 否   | 消息发送方QQ号 |
| receiver_id | VARCHAR(20) | 否   | 消息接收方QQ号（智能体/好友） |
| msg_type | VARCHAR(10) | 否   | 消息类型（text/photo/voice） |
| msg_content | TEXT | 否   | 文本内容/照片路径/语音原文件路径 |
| voice_text | TEXT | 否   | 语音转写结果（非语音消息为空） |
| send_time | DATETIME | 否   | 消息发送时间 |
| is_read | TINYINT(1) | 否   | 是否已处理（1是0否） |

照片元数据表（photo_meta）- 关联照片与交互场景

|     |     |     |     |
| --- | --- | --- | --- |
| 字段名 | 字段类型 | 主键  | 备注  |
| photo_id | INT(11) | 是   | 自增主键 |
| photo_path | VARCHAR(255) | 否   | Windows本地存储绝对路径 |
| related_friend | VARCHAR(20) | 否   | 关联好友QQ号（谁发送/给谁发送） |
| photo_name | VARCHAR(100) | 否   | 照片文件名 |
| upload_time | DATETIME | 否   | 照片收发时间 |
| photo_desc | VARCHAR(255) | 否   | 照片语义描述（向量检索辅助） |

系统配置表（system_config）- 存储系统运行参数

|     |     |     |     |
| --- | --- | --- | --- |
| 字段名 | 字段类型 | 主键  | 备注  |
| config_key | VARCHAR(50) | 是   | 配置键（如voice_api_key） |
| config_value | TEXT | 否   | 配置值 |
| config_desc | VARCHAR(100) | 否   | 配置说明 |
| update_time | DATETIME | 否   | 配置更新时间 |

向量数据库存储设计（语义记忆核心）

采用双向量库分离存储，提升检索效率，适配Windows轻量化需求

- 文本记忆向量库

存储维度：聊天文本内容、对应好友ID、消息时间戳、Sentence-BERT生成的768维语义向量

检索场景：输入文本关键词，检索关联历史聊天记录，实现上下文记忆

- 照片记忆向量库

存储维度：照片Windows本地路径、对应好友ID、上传时间戳、CLIP生成的图像特征向量

检索场景：输入文本描述，检索语义/视觉匹配的历史照片，支持快速调取发送

六、项目实施计划（分5阶段，周期5-7周，适配Windows落地）

阶段1：环境搭建与基础准备（1周，核心铺垫）

- Windows环境配置：安装Python3.9+、MySQL8.0（配置开机自启、远程访问权限）、Anaconda/venv（创建独立依赖环境）
- 依赖工具部署：下载Windows版ffmpeg（配置系统环境变量）、nssm（后续注册系统服务用）、Navicat（MySQL可视化）
- QQ协议框架部署：安装go-cqhttp+NoneBot2，完成基础配置，实现QQ账号扫码登录、文本消息收发测试
- 数据库初始化：通过Navicat创建数据库，执行MySQL建表语句，完成基础数据结构搭建
- 文档输出：完成《环境搭建手册》，记录各软件安装步骤、配置要点、常见问题

阶段2：基础交互与照片存储功能开发（1-2周，核心功能落地）

- 完善QQ交互功能：实现图片消息接收与发送，支持选择Windows本地照片发送给指定好友
- 照片存储功能开发：配置本地照片存储目录（按好友+日期分文件夹），接收照片自动归档，同步元数据至photo_meta表
- 基础查询功能：实现按好友ID、时间范围，查询聊天记录与关联照片
- 文档输出：更新《功能使用手册》，补充照片收发、聊天记录查询操作说明

阶段3：语音识别模块集成与调试（1周，补齐语音交互能力）

- 语音格式转换：集成ffmpeg，编写格式转换脚本，实现QQ语音（amr/silk）转wav格式
- 语音识别接入：对接百度/阿里云语音API（配置密钥）或部署PocketSphinx离线模型，完成语音转文字功能开发
- 功能调试：测试不同语音长度、口音的识别准确率，优化转换与识别流程，转写结果同步至chat_record表
- 文档输出：编写《语音识别配置指南》，记录API密钥配置、离线模型部署步骤

阶段4：向量数据库集成与记忆功能开发（1-2周，实现智能记忆）

- 向量数据库部署：安装Chroma/FAISS，完成Python SDK接入，搭建文本+照片双向量库
- 向量生成与入库：集成Sentence-BERT、CLIP模型，实现聊天文本、照片自动生成向量并入库
- 语义检索功能开发：实现按文本语义检索关联聊天记录与照片，支持检索结果调用与发送
- 主动聊天功能：开发定时触发、场景触发逻辑，实现智能体主动发起聊天，可携带检索到的历史照片/内容
- 文档输出：补充《向量数据库配置手册》，记录向量库搭建、检索功能使用说明

阶段5：系统优化、部署收尾与文档完善（1周，保障稳定可用）

- 稳定性优化：解决消息延迟、识别失败、检索卡顿等问题，优化各模块衔接逻辑
- 后台运行配置：使用nssm将Python项目注册为Windows系统服务，实现开机自启、后台无窗口运行
- 日志与监控优化：完善日志输出逻辑，关键异常添加弹窗提醒，日志按日期归档
- 文档全量完善：整合所有手册，输出《项目总文档》，覆盖环境搭建、部署配置、功能使用、问题排查全流程
- 整体测试：全功能测试（登录、收发消息、语音识别、照片记忆、主动聊天），持续运行72小时验证稳定性

七、Windows部署与运维保障（落地关键）

- 一键部署优化：编写bat脚本，实现Python依赖批量安装、数据库初始化、服务注册一键执行，降低部署门槛
- 进程守护：通过Windows系统服务+日志监控，保障进程异常退出后自动重启，无需人工干预
- 权限配置：给照片存储目录、日志目录配置读写权限，避免Windows权限不足导致的文件操作失败
- 备份策略：配置MySQL定时备份（每日凌晨备份）、照片目录定期备份，避免数据丢失
- 常见问题应对：整理Windows环境下常见问题（如端口占用、登录风控、依赖冲突），纳入项目文档排查指南

八、测试计划（分层测试，保障功能可用）

- 单元测试：针对各核心模块（QQ交互、语音识别、向量检索）单独测试，验证功能有效性
- 集成测试：测试模块间衔接逻辑（如语音识别→转写入库→语义检索），保障全流程通畅
- 功能全测：覆盖QQ登录、文本/图片/语音收发、主动聊天、照片存储/检索、语义记忆所有功能，验证场景全覆盖
- 稳定性测试：Windows环境下持续运行72小时，模拟网络波动、电脑休眠唤醒，检查系统是否稳定、数据是否丢失
- 易用性测试：验证后台运行、开机自启、异常提醒功能，确保非专业用户也能正常使用

九、风险与应对方案（提前规避，保障项目推进）

- QQ账号风控风险：使用go-cqhttp/mirai可能触发QQ账号限制登录/冻结

应对：优先使用QQ小号测试，避免高频批量发消息，遵循QQ使用规范；风控后通过QQ安全中心解封，更换协议库版本重试

- 语音识别准确率低：离线方案识别效果差，在线方案无网络不可用

应对：优先选用在线语音API，保障准确率；预留双方案切换接口，无网络时切换离线模型；对转写结果增加人工校对入口

- 向量检索效率低：数据量增大后检索卡顿

应对：优化向量维度（降低特征向量维度），给向量数据库配置索引；限制单次检索数据范围（如近3个月内容），提升响应速度

- Windows环境依赖冲突：Python依赖库版本不兼容，导致程序无法运行

应对：使用venv/Anaconda创建独立环境，固化依赖版本并输出requirements.txt；编写依赖安装脚本，统一环境配置

- 进程异常退出：Windows系统重启、资源占用过高导致进程崩溃

应对：通过nssm配置服务自动重启；优化程序资源占用，避免内存泄漏；关键节点增加数据缓存，防止数据丢失

十、项目交付物（完整闭环，可直接落地）

- 项目代码资产：完整Python项目代码（含配置文件、脚本、依赖清单requirements.txt）
- 数据库资产：MySQL建表语句、初始化脚本；向量数据库配置文件、向量生成脚本
- 部署脚本资产：Windows环境依赖安装bat脚本、系统服务注册脚本、数据库备份脚本
- 完整项目文档（核心交付物）：
    - 《环境搭建手册》：全软件安装、环境配置步骤，零基础可落地
    - 《项目部署手册》：代码部署、服务注册、开机自启配置流程
    - 《功能使用手册》：各功能操作步骤，含QQ交互、照片管理、语音识别、主动聊天等
    - 《配置指南合集》：含MySQL、向量数据库、语音API、协议框架配置说明
    - 《问题排查手册》：常见故障现象、原因分析、解决方法，快速定位问题
- 测试资产：功能测试用例、稳定性测试报告

十一、后续扩展方向（预留迭代空间）

- 智能度升级：接入大语言模型（如本地部署LLM），提升交互的自然度与智能性，支持复杂场景对话
- 多账号管理：支持多个QQ账号同时登录、独立交互，适配多场景使用需求
- 记忆优化：增加记忆优先级设置，重要内容留存更久，无用记忆自动清理
- 可视化界面：开发Windows桌面可视化UI，无需命令行，通过界面完成所有配置与操作
- 更多交互能力：新增文件收发、表情包发送、群聊管理（如群消息过滤、群统计）功能